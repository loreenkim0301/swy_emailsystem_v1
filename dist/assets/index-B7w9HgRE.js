(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();let m=null;function I(){const s="https://fuydyfeeskrzpmeqdiah.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1eWR5ZmVlc2tyenBtZXFkaWFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NDYzNDIsImV4cCI6MjA2NjMyMjM0Mn0.TnIfkqE0AYNHK0xyHrsdrLChHAljEw3S3vmRsZM2T6M";try{return m=supabase.createClient(s,e),console.log("✅ Supabase 클라이언트 초기화 완료"),!0}catch(t){return console.error("❌ Supabase 클라이언트 초기화 실패:",t),!1}}async function p(s){if(!m)throw new Error("Supabase 클라이언트가 초기화되지 않았습니다.");try{const{data:e,error:t}=await m.from("subscribers").select("id, status").eq("email",s).maybeSingle();if(t)throw t;if(e){if(e.status==="active")return{success:!1,message:"이미 구독 중인 이메일 주소입니다."};{const{error:n}=await m.from("subscribers").update({status:"active",updated_at:new Date().toISOString()}).eq("email",s);if(n)throw n;return{success:!0,message:"다시 구독해주셔서 감사합니다! 바이브코드제로 클럽의 최신 소식을 받아보세요."}}}const{data:i,error:o}=await m.from("subscribers").insert([{email:s,source:"emailjs-learning-tool",status:"active"}]).select().single();if(o)throw o;return console.log(`✅ 새 구독자 추가: ${s}`),{success:!0,message:"구독이 완료되었습니다! 바이브코드제로 클럽의 최신 소식을 받아보세요.",subscriber_id:i.id}}catch(e){throw console.error("구독 처리 중 오류:",e),new Error("구독 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.")}}let a=null,E=!1,b=!1;document.addEventListener("DOMContentLoaded",function(){console.log("페이지 로드 완료"),b=I(),setTimeout(()=>{h()},500)});function h(){const s=document.getElementById("debugInfo"),e=document.getElementById("debugText");if(s.classList.remove("hidden"),typeof emailjs>"u")return e.innerHTML="❌ EmailJS 라이브러리 로드 실패<br>네트워크 연결을 확인해주세요.",document.getElementById("troubleshoot").classList.remove("hidden"),!1;{let t="✅ EmailJS 라이브러리 로드 완료<br>준비 상태: 정상<br>🔒 보안: 모든 정보는 메모리에서만 처리됩니다";return b?t+="<br>✅ Supabase 연결 완료 (구독 기능 활성화)":t+="<br>⚠️ Supabase 연결 필요 (구독 기능 비활성화)",e.innerHTML=t,!0}}window.saveAndTestConfig=function(){const s=document.getElementById("publicKey").value.trim(),e=document.getElementById("serviceId").value.trim(),t=document.getElementById("templateId").value.trim(),i=document.getElementById("toEmail").value.trim();if(!s||!e||!t||!i){c("configStatus","모든 필드를 입력해주세요! ⚠️","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){c("configStatus","올바른 이메일 주소를 입력해주세요! ⚠️","error");return}if(typeof emailjs>"u"){c("configStatus","❌ EmailJS 라이브러리가 로드되지 않았습니다. 페이지를 새로고침해주세요.","error"),document.getElementById("troubleshoot").classList.remove("hidden");return}a={publicKey:s,serviceId:e,templateId:t,toEmail:i},S()};function S(){if(!(!a||typeof emailjs>"u"))try{emailjs.init({publicKey:a.publicKey,blockHeadless:!0,limitRate:{id:"app",throttle:1e4}}),E=!0,console.log("EmailJS 초기화 완료"),B(),v()}catch(s){console.error("EmailJS 초기화 실패:",s),c("configStatus","❌ EmailJS 초기화 실패: "+s.message,"error"),document.getElementById("troubleshoot").classList.remove("hidden")}}function B(){c("configStatus","✅ 설정이 저장되고 EmailJS가 초기화되었습니다! (메모리에서만 처리됨)","success"),document.getElementById("configDisplay").classList.remove("hidden"),document.getElementById("configText").textContent=`Public Key: ${a.publicKey.substring(0,10)}...
Service ID: ${a.serviceId}
Template ID: ${a.templateId}
To Email: ${a.toEmail}`,document.getElementById("step1").classList.add("completed"),document.getElementById("step1").classList.remove("active"),document.getElementById("troubleshoot").classList.add("hidden")}function v(){document.getElementById("step2").classList.add("active"),document.getElementById("connectionWaiting").classList.add("hidden"),document.getElementById("connectionTest").classList.remove("hidden")}window.testConnection=function(){if(!E){c("testStatus","❌ EmailJS가 초기화되지 않았습니다. 1단계를 다시 완료해주세요.","error");return}c("testStatus","🔄 연결을 테스트하는 중...","info");const s={name:"테스트 사용자",email:"test@example.com",subject:"EmailJS 연결 테스트",message:"EmailJS 학습 도구에서 보내는 연결 테스트 메일입니다. 이 메일이 도착했다면 설정이 올바릅니다!"};console.log("연결 테스트 시작:",{serviceId:a.serviceId,templateId:a.templateId,data:s}),emailjs.send(a.serviceId,a.templateId,s).then(function(e){console.log("연결 테스트 성공!",e),a.connectionTested=!0,L(),w()}).catch(function(e){console.error("연결 테스트 실패:",e);let t="연결 테스트 실패: ";e.status===400?t+="잘못된 요청입니다. 템플릿 ID나 서비스 ID를 확인해주세요.":e.status===401?t+="인증 실패입니다. Public Key를 확인해주세요.":e.status===404?t+="템플릿이나 서비스를 찾을 수 없습니다. ID를 확인해주세요.":t+=e.text||e.message||"알 수 없는 오류",c("testStatus","❌ "+t,"error"),document.getElementById("troubleshoot").classList.remove("hidden")})};function L(){c("testStatus","✅ 연결 테스트 성공! EmailJS가 정상적으로 작동합니다.","success"),document.getElementById("step2").classList.add("completed"),document.getElementById("step2").classList.remove("active")}function w(){document.getElementById("step3").classList.add("active"),document.getElementById("emailWaiting").classList.add("hidden"),document.getElementById("emailForm").classList.remove("hidden")}window.sendEmail=function(){const s=document.getElementById("senderName").value.trim(),e=document.getElementById("senderEmail").value.trim(),t=document.getElementById("subject").value.trim(),i=document.getElementById("message").value.trim();if(!s||!e){c("emailStatus","보내는 사람 이름과 이메일은 필수입니다! ⚠️","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){c("emailStatus","올바른 이메일 주소를 입력해주세요! ⚠️","error");return}const n=document.getElementById("sendBtn"),d=document.getElementById("sendBtnText"),y=document.getElementById("sendBtnLoading");n.disabled=!0,d.classList.add("hidden"),y.classList.remove("hidden");const f={name:s,email:e};t&&(f.subject=t),i&&(f.message=i),console.log("이메일 발송 시작:",f);let g="📧 이메일 발송 중...";!t&&!i?g+=" (제목과 내용은 템플릿 기본값 사용)":t?i||(g+=" (내용은 템플릿 기본값 사용)"):g+=" (제목은 템플릿 기본값 사용)",c("emailStatus",g,"info"),emailjs.send(a.serviceId,a.templateId,f).then(function(r){console.log("이메일 발송 성공!",r);let l="✅ 이메일이 성공적으로 발송되었습니다!";!t&&!i?l+=`
📝 제목과 내용은 EmailJS 템플릿의 기본값이 사용되었습니다.`:t?i||(l+=`
📝 내용은 EmailJS 템플릿의 기본값이 사용되었습니다.`):l+=`
📝 제목은 EmailJS 템플릿의 기본값이 사용되었습니다.`,c("emailStatus",l,"success"),document.getElementById("step3").classList.add("completed")}).catch(function(r){console.error("이메일 발송 실패:",r);let l="이메일 발송 실패: ";r.status===400?l+="잘못된 요청입니다. 입력 내용을 확인해주세요.":r.status===401?l+="인증 실패입니다. 설정을 다시 확인해주세요.":r.status===429?l+="너무 많은 요청입니다. 잠시 후 다시 시도해주세요.":l+=r.text||r.message||"알 수 없는 오류",c("emailStatus","❌ "+l,"error")}).finally(function(){n.disabled=!1,d.classList.remove("hidden"),y.classList.add("hidden")})};window.handleSubscription=async function(){const s=document.getElementById("subscriptionEmail").value.trim(),e=document.getElementById("subscribeBtn"),t=document.getElementById("subscribeBtnText"),i=document.getElementById("subscribeBtnLoading");if(!s||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)){u("올바른 이메일 주소를 입력해주세요.","error");return}if(!b){u("Supabase 연결이 필요합니다. 관리자에게 문의해주세요.","error");return}e.disabled=!0,t.classList.add("hidden"),i.classList.remove("hidden");try{const n=await p(s);n.success?(u(n.message,"success"),document.getElementById("subscriptionEmail").value=""):u(n.message,"error")}catch(n){console.error("구독 처리 중 오류:",n),u(n.message,"error")}finally{e.disabled=!1,t.classList.remove("hidden"),i.classList.add("hidden")}};function u(s,e){const t=document.getElementById("subscriptionStatus");t.textContent=s,t.className=`subscription-status ${e}`,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}function c(s,e,t){const i=document.getElementById(s);i.textContent=e,i.className=`status-message ${t}`,i.style.display="block",t==="success"&&setTimeout(()=>{i.style.display="none"},7e3)}window.addEventListener("beforeunload",function(s){if(a){const e="페이지를 새로고침하면 입력한 모든 설정이 삭제됩니다.";return s.returnValue=e,e}});document.getElementById("subscriptionEmail").addEventListener("keypress",function(s){s.key==="Enter"&&handleSubscription()});
